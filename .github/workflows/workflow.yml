name: Daily Polyratings DB Dump

on:
    push:
        branches:
            - runner
    schedule:
        - cron: '0 0 * * *'

jobs:
    db-dumper:
        name: Polyratings Database Dumper
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Repo
              uses: actions/checkout@master

            - name: Run Python Script
              env:
                  POLYRATINGS_USERNAME: ${{ secrets.POLYRATINGS_USERNAME }}
                  POLYRATINGS_PASSWORD: ${{ secrets.POLYRATINGS_PASSWORD }}

            - name: Get Current Date
              id: date
              run: echo "::set-output name=date::$(date +'%Y-%m-%dT%H:%M:%S')"

            - name: Commit Generated Files
              uses: EndBug/add-and-commit@v9
              with:
                  add: ['professor-dump.json', 'professor-list.json']
                  author_name: 'Addison Tustin'
                  author_email: 'addison@atustin.dev'
                  message: 'Upload new DB dump at ${{ steps.date.outputs.date }}'
                  push: origin data --force


